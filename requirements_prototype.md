# AI 电影分镜与多模态生成平台（单机单用户 MVP）

> 面向 5 人以下独立创作者团队的专业创作平台的 MVP 版本，当前聚焦“电影分镜 + 文生图 + 文生视频 + 图生视频 + 资产一致性锁定 + 多版本对比”。本文件为需求说明书与原型文档（文字版），供产品、设计、研发统一执行。

---

## 1. 背景与目标

### 1.1 背景
独立创作者需要在有限人力下完成从故事设定、分镜、资产一致性到成片输出的闭环。传统工具对 AI 生成与分镜管理割裂，导致重复输入、版本混乱、风格不一致。

### 1.2 产品目标
- 一站式创作流程：画面(分镜)/视频 → 版本筛选 → 输出

---

## 2. 用户与场景

### 2.1 目标用户
- 单机单用户（个人创作者）
- 有分镜/短片创作经验，需要效率与一致性

### 2.2 核心痛点
- 重复输入提示词与参考图，难以复用
- 版本混乱，没有清晰“主版本”
- 角色/风格不一致，镜头间跳变明显
- 分镜表格化工具与 AI 生成割裂

---

## 3. 术语定义
- **项目（Project）**：一个创作项目，包含多个分镜与资产
- **分镜（Shot）**：一个镜头的内容与生成结果单位
- **资产（Asset）**：角色、场景、风格、核心物品（文本/图片形式）
- **版本（Version）**：同一分镜的不同生成结果
- **主版本**：当前被选定为输出或后续编辑基础的版本

---

## 4. 功能范围与优先级

### 4.1 必做功能（MVP）
- 项目管理与配置
- 电影分镜编排（编排具体只的是，分镜顺序可拖拽排序，可在任意分镜位置添加/删除/复制分镜）
- 多模态生成（生图/生视频，注：图/视频都支持输入参考图）
- 版本对比与主版本选择
- 本地导入/导出与存储管理

---

## 5. 详细需求（功能规格）

> 每个功能点包含：功能描述、输入、输出、约束、错误防护。

### 5.0 约束与边界（当前版本）
- 单机单用户
- 模型配置入口暂不提供（后续补充）

### 5.1 项目

#### FR-1 新建项目
- 功能描述：创建一个新的创作项目并初始化分镜结构
- 输入字段：
  - 项目名称（必填，2-50 字）
  - 默认分辨率（16:9/9:16/1:1/自定义）
  - 默认时长（5/10/15秒）
- 输出：创建项目并进入工作台
- 约束：项目名称不可重复
- 错误防护：未填写必填字段时禁止创建

#### FR-2 项目设置
- 功能描述：配置项目级别一致性和模型预设
- 输入：
  - 一致性锁定：角色/场景/风格/核心物品（开关）
  - 默认模型与参数模板
- 输出：设置持久保存，作用于所有分镜
- 约束：锁定开启后，分镜默认继承

### 5.2 电影分镜管理

#### FR-5 分镜状态
- 状态：未生成 / 生成中 / 已生成


#### FR-7 生图
- 输入：提示词、资产引用（可选图片）
- 参数：分辨率（2k/4k）
- 输出：1~N 个版本
- 错误防护：提示词超过长度限制时给出提示

#### FR-8 生视频
- 输入：提示词、负向提示词、资产引用
- 参数：帧率、时长、运动强度
- 输出：视频版本 + 自动首帧/关键帧截图

#### FR-9 图生视频
- 输入：参考图 + 提示词
- 参数：运动强度、时长、帧率、补帧
- 输出：视频版本 + 关键帧

#### FR-10 微调
- 支持：遮罩重绘、局部提示词增强、风格强度调节
- 约束：需从主版本进入微调

### 5.4 版本管理

#### FR-11 版本栈
- 功能描述：自动存储每次生成并归档
- 字段：版本号、时间、参数、生成来源
- 约束：主版本唯一

#### FR-11.1 版本保留与归档
- 默认保留：主版本 + 最近 N 个版本（默认 N=10）
- 清理触发：生成完成后自动检查 / 手动“清理历史”
- 删除规则：先删媒体文件，再删版本记录
- 撤销机制：提供 30 秒撤销窗口

#### FR-12 版本对比
- 功能描述：2~4 格对比视图
- 输出：可快速选定主版本
- 交互：参数差异与提示词差异高亮标记

### 5.5 资产管理

#### FR-13 资产类型
- 角色卡（Character）
- 场景卡（Scene）
- 风格卡（Style）
- 核心物品卡（Key Object）

#### FR-14 核心物品卡（剧情道具）
- 字段：名称、形态描述、关键特征、参考图、变体
- 用途：保证剧情核心物品在分镜间一致

#### FR-15 一致性锁定
- 项目级锁定：角色/风格/世界观
- Scene 级覆盖：局部替换
- Shot 级覆盖：临时替换
- 约束：锁定资产默认必须引用

#### FR-15.1 一致性锁定优先级
- 覆盖顺序：Shot 级 > Scene 级 > 项目级
- 继承规则：下层未设置时自动继承上层
- 冲突处理：同类型资产只允许 1 个激活，其他标记为备选

---

## 6. 原型文档（页面结构清单 + 控件列表）

### 6.1 项目总览页（Project Hub）

**布局**：顶部导航 + 主区域卡片 + 右侧信息栏

**控件清单**
- 顶部导航：Logo / 全局搜索 / 新建项目
- 项目卡片：缩略图、名称、类型、最后编辑时间
- 模板入口：项目模板（剧情/动画/短片/空白）
- 右侧面板：模型资源状态、配额/队列、使用统计

**状态设计**
- 空状态：展示“新建项目”指引
- 加载状态：卡片骨架屏
- 异常状态：项目不存在/读写失败提示

### 6.2 工作台（Storyboard Workspace）

**布局**：左侧分镜列表 + 中部预览区 + 右侧编辑区

**顶部栏控件**
- 项目名 / 当前场景（Scene）下拉
- 一致性锁定状态（角色/风格/世界观/核心物品）
- 模型选择 + 参数预设
- 导出 / 历史 / 帮助

**左侧分镜区（分镜管理）**
- Scene 列表：新增/重命名/排序/折叠
- Shot 列表：缩略图、编号、状态标签、时长、镜头类型
- 批量操作：批量生成 / 批量设置镜头语言 / 批量引用资产
- 视图切换：缩略图视图 / 列表视图 / 电影分镜表视图

**中部预览区（画面/视频）**
- 预览播放器：图像/视频切换、播放/暂停、逐帧
- 版本栈（水平）：版本缩略图 + 版本号 + 标记主版本
- 版本对比：2/3/4 格对比视图切换
- 差异提示：参数差异标记、提示词差异标记

**右侧编辑区（提示词与参数）**
- Prompt：正向/负向输入框（支持变量与模板）
- 资产引用：角色/场景/风格/核心物品标签化
- 镜头语言：镜头类型/运动/焦距/构图/时长
- 生成参数：分辨率/步数/CFG/风格强度/帧率/时长
- 微调工具：遮罩重绘、局部提示词增强
- 生成按钮：生成图 / 生成视频 / 继续生成

**分镜交互细节**
- 选择 Shot 自动加载参数与资产引用
- 拖拽排序后自动保存并提示成功
- 生成前提示费用与预计时间
- 生成完成后自动进入版本栈

### 6.3 电影分镜表视图（专业模式）

**布局**：表格视图（支持横向滚动）

**列字段**
- 镜头编号
- 镜头类型
- 镜头运动
- 时长
- 构图/景别
- 焦距/镜头
- 场景描述（剧情）
- 画面描述（视觉）
- 音效/氛围
- 生成状态
- 主版本缩略图

**交互**
- 单元格可直接编辑
- 批量填充与复制上一行
- 与缩略图视图双向同步

### 6.4 资产管理页（Assets）

**布局**：顶部类型切换 + 中部卡片流 + 右侧详情

**控件清单**
- 类型 Tab：角色 / 场景 / 风格 / 核心物品
- 筛选：使用频次、最近使用、项目关联
- 卡片：缩略图、名称、使用次数、关联 Scene 数
- 详情：描述、参考图、参数模板、关联分镜
- 操作：新建/复制/版本回溯/引用到分镜

### 6.5 导出与成片页（可选）

**控件清单**
- 分镜序列预览
- 合成设置：帧率、转场、输出比例
- 输出格式：视频/图片序列

### 6.6 项目导入/导出（本地化备份）

**功能说明**
- 允许导出单个项目为 zip 包（媒体文件 + metadata.json）
- 允许导入 zip 还原为完整项目

**约束**
- 导入时若项目名称冲突，提示重命名
- 导入失败需给出错误定位（缺失文件/版本不一致）

---

## 7. 数据结构（字段字典）

### 7.1 Project
- id, name, type, resolution, fps
- default_model, default_params, default_negative_prompt
- lock_character, lock_style, lock_world, lock_key_object

### 7.2 Scene
- id, project_id, name, order

### 7.3 Shot
- id, scene_id, order, shot_type, camera_move, duration
- composition, lens, story_desc, visual_desc
- prompt, negative_prompt, asset_refs
- status

### 7.4 Version
- id, shot_id, type(image/video), url, params
- created_at, is_primary

### 7.5 Asset
- id, type(character/scene/style/key_object), name
- description, reference_images, meta

---

## 8. 状态机

### 8.1 生成任务状态
- 队列中 → 生成中 → 成功 / 失败

---

## 9. 错误防护与易用性设计
- 所有“生成”动作前提示：确认参数/模型/费用
- 版本锁定：删除前二次确认
- 批量操作提供“撤销”入口
- 网络异常：保留本地草稿并提示重试

### 9.1 空状态与边界提示
- 空项目：引导创建 Scene/Shot
- 空分镜：显示示例字段与一键生成引导
- 无版本：提示生成/导入参考图
- 存储空间不足：提示清理历史版本或更改存储路径

---

## 10. UI 风格要求
- Apple 风格：简洁、克制、强调空间与层级
- 颜色：中性色为主，少量高亮色用于状态与主操作
- 字体：优先使用系统字体（macOS: SF Pro / Windows: Segoe UI / Linux: Noto Sans）
- 组件：高圆角、柔和阴影、卡片与面板分层清晰
- 交互：平滑过渡，避免过度动效
- 强调分镜预览区与版本对比功能

### 10.1 资源与性能约束
- 单项目建议上限：100 个 Scene / 1000 个 Shot
- 单 Shot 版本上限：默认 20（超过提示归档）
- 单次批量生成上限：默认 20 个 Shot

### 10.2 本地存储路径策略
- 首次启动引导用户选择媒体存储路径
- 允许在设置中切换路径并提供迁移提示
- 未选择路径时使用默认目录 `~/PixcoreStorage`

---

## 11. 交互流程示例

### 11.1 创建分镜
1. 新建 Scene
2. 添加 Shot（镜头）
3. 输入剧情描述与提示词
4. 引用角色/场景/核心物品
5. 点击生成

### 11.2 版本筛选
1. 生成后进入版本栈
2. 选择对比视图
3. 选择主版本并标注

### 11.3 微调
1. 选择主版本
2. 启动局部重绘/遮罩
3. 生成新版本并比较

---

## 12. 验收标准（核心功能）
- 项目创建后可进入工作台并自动生成默认 Scene
- 分镜表视图编辑后，缩略图视图同步更新
- 生成任务完成后，版本栈可见并可设置主版本
- 项目导出后可在新环境完整导入（含媒体与元数据）

---

## 13. 交付物
- 本文档为详细需求说明书 + 原型文档
- 后续可按此拆分开发任务与 UI 高保真设计
